db.ventas.aggregate([{ $unwind: "$productos" }, {$group: {_id: "$productos.productoId",totalUnidadesVendidas: { $sum: "$productos.cantidad" }}},{ $sort: { totalUnidadesVendidas: -1 } }])